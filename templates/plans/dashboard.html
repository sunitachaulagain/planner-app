{% extends 'base.html' %} {% load static %} {% block content %}

<div class="container my-4">
  <!-- =====================
       Messages (Welcome)
       ===================== -->
  {% if messages %} {% for message in messages %}
  <div class="alert alert-success">{{ message }}</div>
  {% endfor %} {% endif %}

  <!-- =====================
       Header
       ===================== -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3>Dashboard</h3>
    <a href="{% url 'list_categories' %}" class="btn btn-primary">
      View All Categories
    </a>
  </div>

  {% if grouped %}
  <!-- TODAY PIE CHART -->
  <div class="card shadow-sm mb-4">
    <div class="card-body text-center">
      <h5>Today's Task Completion</h5>
      <div style="max-width: 300px; margin: 0 auto">
        <canvas id="todayPie" width="300" height="300"></canvas>
      </div>
    </div>
  </div>

  <!-- TODAY'S TASKS ORGANIZED -->
  <div class="card shadow-sm">
    <div class="card-body">
      <h5 class="mb-3">Today's Tasks</h5>

      {% for category, plans in grouped.items %}
      <div class="mb-3">
        <h6 class="text-primary">{{ category }}</h6>

        {% for plan, tasks in plans.items %}
        <div class="ms-3 mb-2">
          <strong>{{ plan }}</strong>

          <ul class="list-group mt-1">
            {% for task in tasks %}
            <li class="list-group-item d-flex justify-content-between">
              <span>{{ task.title }}</span>
              {% if task.is_completed %}
              <span class="badge bg-success">Done</span>
              {% else %}
              <span class="badge bg-warning text-dark">Pending</span>
              {% endif %}
            </li>
            {% endfor %}
          </ul>
        </div>
        {% endfor %}
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const ctx = document.getElementById('todayPie').getContext('2d');
    new Chart(ctx, {
        type: 'pie',
        data: {
            labels: ['Completed', 'Pending'],
            datasets: [{
                data: {{ today_pie|safe }},
                backgroundColor: ['#4caf50', '#ffc107']
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'top' },
                title: { display: true, text: "Today's Task Completion" }
            }
        }
    });
  </script>

  {% else %}
  <p class="text-muted text-center">No tasks for today.</p>
  {% endif %}
</div>

{% endblock %}
